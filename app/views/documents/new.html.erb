<%= form_for @document, url: {action: "create"}, html: {class: "ui form"} do |f| %>
  <!-- text area -->
  <div class="field">
    <label>Paste your text here:</label>
    <div autofocus name="" id="editor"></div>
    <%= f.hidden_field(:content) %>
  </div>

  <%= content_tag :div, nil, class: ["divider", "divider30"] %>

  <!-- attributes -->
  <div class="ui grid">
    <!-- title -->
    <div class="four wide computer eight wide tablet sixteen wide mobile column">
      <%= f.label :title %>
      <%= f.text_field(:title) %>
    </div>

    <div class="four wide computer eight wide tablet sixteen wide mobile column">
      <%= f.label :expire %>
      <div class="ui">
        <div class="ui fluid normal selection dropdown dropdown-expire">
          <%= f.hidden_field(:expire, value: 0) %>
          <i class="dropdown icon"></i>
          <div class="default text">After reading</div>
          <%= expire_dropdown %>
        </div>
      </div>
    </div>

    <!-- syntax -->
    <div class="four wide computer eight wide tablet sixteen wide mobile column">
      <%= f.label :syntax %>
      <div class="ui">
        <div class="ui fluid search normal selection dropdown dropdown-syntax">
          <%= f.hidden_field(:syntax, value: 'plain_text') %>
          <i class="dropdown icon"></i>
          <div class="default text">Plain text</div>
          <%= syntax_dropdown %>
        </div>
      </div>
    </div>
  </div> <!-- end of attribute section -->

  <%= content_tag :div, nil, class: ["divider", "divider30"] %>
  <%= content_tag :div, nil, class: ["ui", "error", "message"] %>

  <%= button_tag(type: 'submit', class: 'ui button fluid teal') do %>
    Submit <small>(Alt + Enter)</small>
  <% end %>

<% end %>
 <!--  end of form -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.3/ace.js" type="text/javascript" charset="utf-8"></script>
<script>
// Init editor
var editor = ace.edit("editor");
editor.setTheme("ace/theme/github");
editor.getSession().setMode("ace/mode/github");
editor.focus();

// Assign value in editor to form input
editor.getSession().on("change", function(e){
  editorVal = editor.getValue();
  try {
    $('#document_content').val(editorVal);
  } catch(e){
    // Do smt if error
  }
})

// Set syntax
$('.dropdown-syntax').dropdown({
  action: 'activate',
  onChange: function(value, text, $choice) {
    editor.getSession().setMode("ace/mode/" + value);
    return;
  }
});

// Set expire
$('.dropdown-expire').dropdown();

// Define from validation rule
var validationRules = {
  content: {
    identifier  : 'document[content]',
    rules: [
      {
        type   : 'empty',
        prompt : 'Forgot your text'
      }
    ]
  }
}

// Form handle
$('.ui.form').form({
  on: 'submit',
  fields: validationRules,
  // When validation is successful
  onSuccess: function(event, fields){
    event.preventDefault();
    var myForm = $('.ui.form');
    var sbmButton = $('.ui.form .button');

    sbmButton.addClass('loading disabled');

    $.ajax({
      type: myForm.attr('method'),
      url: myForm.attr('action'),
      data: fields,
      statusCode: {
        201: function (data) {
          console.log(data);
        },
        400: function (data) {
        },
        500: function (data) {
        }
      }
    }).fail(function( data ) {
      // Do after failure
      console.log(data);
      alert("Error!!! Try again later");
    }).always(function( data ) {
      // Always execute after ajax call done
      sbmButton.removeClass('loading disabled');
    });

    return false
  }
});
</script>
